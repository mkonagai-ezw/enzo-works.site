<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1W5PFPG6PV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1W5PFPG6PV');
</script>
    <title>ENZO WORKS</title>
    <link rel="icon" href="images/favicon.png">
    <link rel="apple-touch-icon" href="images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="header">
        <div class="logo">
            <img src="images/logo.png" alt="ENZO WORKS" class="logo-img" fetchpriority="high">
        </div>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <nav class="nav">
            <ul>
                <li><a href="#about">About</a></li>
                <li><a href="#service">Service</a></li>
                <li><a href="#contact" class="btn-contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h1 class="main-title">Think freely,<br>Build smart.</h1>
            <p class="sub-text">
                愛媛・西条を拠点に。<br>
                自由な発想と確かな技術で、ビジネスを加速させる。
            </p>
        </div>
    </section>

    <section id="about" class="section">
        <div class="container">
            <h2 class="section-title">About Me</h2>
            <div class="about-wrapper">
                <div class="about-image">
                    <img src="images/profile.webp" alt="Profile Icon" loading="lazy">
                </div>
                <div class="about-text">
                    <h3>KONAGAI MASAHIRO</h3>
                    <p class="role">Creative Director / Engineer</p>
                    <p class="description">
                        東京から移住し、愛媛・西条を拠点に活動するクリエイティブパートナー。<br>
                        「Think freely, Build smart.」を掲げ、Web制作からAI活用まで、
                        ビジネスとテクノロジーの架け橋として伴走します。
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="service" class="section">
        <div class="container">
            <h2 class="section-title">Service</h2>
            <p class="section-desc">ENZO WORKSが提供する8つの価値。</p>
            <div class="service-grid">
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-laptop-code"></i></div>
                    <h3>Webサービス開発</h3>
                    <p>コーポレートサイトからWebアプリケーションまで。<br>ビジネスの成長を支える基盤を構築します。</p>
                </div>
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-pen-nib"></i></div>
                    <h3>デザイン</h3>
                    <p>ロゴ制作、UI/UXデザイン、ブランディング。<br>想いを視覚化し、ユーザーの心に届けます。</p>
                </div>
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-robot"></i></div>
                    <h3>AI活用コンサルティング</h3>
                    <p>ChatGPTなどの最新AI技術を導入支援。<br>新しい可能性とイノベーションを創出します。</p>
                </div>
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-chart-line"></i></div>
                    <h3>業務効率化</h3>
                    <p>社内DXの推進や自動化ツールの導入。<br>無駄を省き、本質的な業務に集中できる環境を。</p>
                </div>
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-music"></i></div>
                    <h3>楽曲制作</h3>
                    <p>動画BGMからブランドイメージソングまで。<br>世界観を音で表現し、コンテンツの魅力を最大化します。</p>
                </div>
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-film"></i></div>
                    <h3>動画制作</h3>
                    <p>プロモーション映像からSNS用動画編集まで。<br>視覚と聴覚に訴えるコンテンツで、魅力を強力に発信します。</p>
                </div>
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-chalkboard-user"></i></div>
                    <h3>セミナー登壇</h3>
                    <p>ITトレンド、AI活用、キャリア形成など。<br>実体験に基づいたナレッジを、初心者にも分かりやすく解説します。</p>
                </div>
                <div class="service-card">
                    <div class="icon-box"><i class="fa-solid fa-comments"></i></div>
                    <h3>漠然としたご相談</h3>
                    <p>「何から手をつければいいかわからない」<br>そんな段階からの壁打ちも大歓迎。一緒に課題を整理しましょう。</p>
                </div>
            </div>
        </div>
    </section>

    <section id="sandbox" class="section">
    <div class="container">
        <h2 class="section-title">Sandbox</h2>
        <p class="section-subtitle">気が向くまま作ったモノたち、ENZO WORKSの砂場です。</p>

            <div class="sandbox-accordion">
                <div class="sandbox-item">
                    <button class="sandbox-accordion-header">
                        <span class="sandbox-accordion-title">AIは市場予測できるのか？ 5営業日後の終値予想バトル</span>
                        <span class="sandbox-accordion-icon"><i class="fa-solid fa-chevron-down"></i></span>
                    </button>
                    <div class="sandbox-accordion-body" style="display: none;">
        <div class="sandbox-project">
            <h3 class="project-name">AIは市場予測できるのか？<br>5営業日後の終値予想バトル</h3>
            
            <div class="stats-board">
                <div class="stat-item gpt">
                    <span class="model-name">GPT-3.5</span>
                    <span class="main-stat">勝率: <span id="gpt-win-rate">--</span>%</span>
                    <span class="sub-stat">平均誤差: <span id="gpt-avg-error">--</span>%</span>
                </div>
                <div class="vs-divider">VS</div>
                <div class="stat-item gemini">
                    <span class="model-name">Gemini Flash</span>
                    <span class="main-stat">勝率: <span id="gemini-win-rate">--</span>%</span>
                    <span class="sub-stat">平均誤差: <span id="gemini-avg-error">--</span>%</span>
                </div>
            </div>

            <div id="ai-grid" class="ai-grid">
                <div class="loading-msg">Initializing Battle Data...</div>
            </div>
            
            <div class="sandbox-footer">
                <p class="disclaimer">
        <strong>免責事項：</strong><br>
        本システムはAIによる学習データに基づいた実験的な予想を表示するものであり、将来の運用成果を示唆・保証するものではありません。情報の正確性には万全を期していますが、本情報に基づいて被ったいかなる損害についても、当サイトは一切の責任を負いません。投資判断は自己責任でお願いいたします。
    </p>
            </div>
            <p class="disclaimer">※ 5営業日後の終値を予測。土日祝を除いた市場稼働日で計算しています。</p>
                        </div>
                    </div>
                </div>
        </div>
    </div>
</section>

    <section id="contact" class="section">
        <div class="container">
            <h2 class="section-title">Contact</h2>
            <p class="section-desc">制作のご依頼・ご相談はお気軽にどうぞ。</p>
            <div class="contact-btn-wrapper">
                <button id="openModalBtn" class="main-btn">
                    <i class="fa-solid fa-envelope"></i> お問い合わせフォームを開く
                </button>
            </div>
        </div>
    </section>

    <!-- チャットボタン -->
    <div class="chat-button-wrapper">
        <div id="chatBubble" class="chat-bubble">
            <span id="chatBubbleText">えんぞーだよ。</span>
        </div>
        <button id="chatToggleBtn" class="chat-toggle-btn" aria-label="チャットを開く">
            <img src="images/chatboticon.webp" alt="チャットボット" class="chatbot-icon">
        </button>
    </div>

    <!-- チャット窓 -->
    <div id="chatWindow" class="chat-window">
        <div class="chat-header">
            <h3>お問い合わせチャット</h3>
            <button id="chatCloseBtn" class="chat-close-btn" aria-label="チャットを閉じる">&times;</button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="chat-message bot-message">
                <img src="images/chatboticon.webp" alt="チャットボット" class="bot-avatar">
                <div class="bot-message-content">
                    <p>こんにちは！ENZO WORKSチャットボット"えんぞー"です。今日はどんなお手伝いをしましょうか？</p>
                    <div class="chat-quick-buttons" id="chatQuickButtons">
                        <button class="quick-btn" data-action="web">Web制作の相談</button>
                        <button class="quick-btn" data-action="ai">AI導入・自動化</button>
                        <button class="quick-btn" data-action="media">楽曲・動画制作</button>
                        <button class="quick-btn" data-action="other">その他</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="chat-footer">
            <div class="chat-limit-info" id="chatLimitInfo"></div>
            <div class="chat-input-wrapper">
                <textarea id="chatInput" class="chat-input" placeholder="メッセージを入力（5文字以上）" rows="2"></textarea>
                <button id="chatSendBtn" class="chat-send-btn" aria-label="送信">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
            <button id="chatContactBtn" class="chat-contact-btn">
                <i class="fa-solid fa-envelope"></i> 直接お問い合わせする
            </button>
        </div>
    </div>

    <footer style="text-align: center; padding: 20px; font-size: 12px; color: #666;">
        &copy; 2025 ENZO WORKS. All Rights Reserved.
    </footer>

    <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>お問い合わせ</h3>
            <div class="form-wrapper">
                <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSc7f9_SiHYfANYvZYiT-5-wZlVxcJZI4z1v-vyoNrNcSwQ61g/viewform?embedded=true" width="640" height="800" frameborder="0" marginheight="0" marginwidth="0">読み込んでいます…</iframe>
            </div>
        </div>
    </div>

    <div class="music-player">
        <div class="player-header">ENZO WORKS original tracks</div>
        <audio id="audio"></audio>
        <div id="playlistPopup" class="playlist-popup">
            <div class="playlist-header">
                <span class="header-text">PLAYLIST</span>
                <span id="closePlaylistBtn" class="close-playlist">&times;</span>
            </div>
            <div id="playlistItems" class="playlist-items"></div>
        </div>
        <div class="player-content">
            <div class="art-wrapper" id="artWrapper">
                <img src="" id="musicArt" alt="Art" class="music-art">
            </div>
            <div class="text-info" id="textInfoArea">
                <span id="musicTitle" class="track-title">Loading...</span>
                <div class="marquee-container">
                    <span id="musicDesc" class="track-desc">Loading...</span>
                </div>
            </div>
            <div class="controls">
                <div id="prevBtn" class="control-btn prev-btn"><i class="fa-solid fa-backward-step"></i></div>
                <div id="playBtn" class="control-btn play-btn"><i id="playIcon" class="fa-solid fa-play"></i></div>
                <div id="nextBtn" class="control-btn next-btn"><i class="fa-solid fa-forward-step"></i></div>
                <div id="listBtn" class="control-btn list-btn"><i class="fa-solid fa-list-ul"></i></div>
            </div>
        </div>
    </div>

    <script>
        // --- ハンバーガーメニュー ---
        const hamburger = document.querySelector('.hamburger');
        const nav = document.querySelector('.nav');
        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            nav.classList.toggle('active');
        });
        document.querySelectorAll('.nav a').forEach(link => {
            link.addEventListener('click', () => {
                hamburger.classList.remove('active');
                nav.classList.remove('active');
            });
        });

        // --- モーダル ---
        const modal = document.getElementById('contactModal');
        const openBtn = document.getElementById('openModalBtn');
        const closeBtn = document.querySelector('.close-btn');
        openBtn.addEventListener('click', () => { modal.style.display = 'flex'; });
        closeBtn.addEventListener('click', () => { modal.style.display = 'none'; });
        window.addEventListener('click', (e) => { if (e.target == modal) { modal.style.display = 'none'; } });

        // --- 音楽プレイヤー（既存ロジック維持） ---
        const playlist = [
            { src: 'audio/audio02.mp3', art: 'audio/02audio.png', title: 'ノスタルジーイズオトナリ', desc: '少子化をテーマにしたブリンバンボンな曲。' },
            { src: 'audio/audio03.mp3', art: 'audio/03audio.png', title: '亡霊', desc: '某映画PJの主題歌候補に作成、たぶんボツになる。' },
            { src: 'audio/audio04.mp3', art: 'audio/04audio.png', title: 'カクサンキボウ', desc: '最近っぽいナウい曲を作りたくて制作' },
            { src: 'audio/audio01.mp3', art: 'audio/01audio.png', title: 'レイジモード', desc: '我が家の3歳末っ子の怒りを表現した楽曲。' }
        ];

        let currentTrackIndex = 0;
        let isPlaying = false;
        const audio = document.getElementById('audio');
        const playBtn = document.getElementById('playBtn');
        const playIcon = document.getElementById('playIcon');
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const listBtn = document.getElementById('listBtn');
        const closePlaylistBtn = document.getElementById('closePlaylistBtn');
        const musicTitle = document.getElementById('musicTitle');
        const musicDesc = document.getElementById('musicDesc');
        const musicArt = document.getElementById('musicArt');
        const playerContent = document.querySelector('.player-content');
        const playlistPopup = document.getElementById('playlistPopup');
        const playlistItems = document.getElementById('playlistItems');
        const artWrapper = document.getElementById('artWrapper');
        const textInfoArea = document.getElementById('textInfoArea');

        function loadTrack(index) {
            const track = playlist[index];
            audio.src = track.src;
            musicTitle.textContent = track.title;
            musicDesc.textContent = track.desc;
            musicArt.src = track.art;
            audio.load();
            updateActivePlaylistItem(index);
        }

        function createPlaylistHTML() {
            playlistItems.innerHTML = '';
            playlist.forEach((track, index) => {
                const item = document.createElement('div');
                item.classList.add('playlist-item');
                if (index === currentTrackIndex) item.classList.add('active');
                item.innerHTML = `
                    <img src="${track.art}" class="list-thumb">
                    <div class="list-info"><div class="list-title">${track.title}</div></div>`;
                item.addEventListener('click', () => {
                    currentTrackIndex = index;
                    loadTrack(currentTrackIndex);
                    playMusic();
                    
                    // ★GA4: プレイリスト選択イベント
                    if (typeof gtag === 'function') {
                        gtag('event', 'music_select_list', { 'track_title': track.title });
                    }
                });
                playlistItems.appendChild(item);
            });
        }

        function updateActivePlaylistItem(index) {
            const items = document.querySelectorAll('.playlist-item');
            items.forEach((item, i) => {
                if (i === index) item.classList.add('active');
                else item.classList.remove('active');
            });
        }

        function playMusic() {
            audio.play();
            isPlaying = true;
            playIcon.classList.remove('fa-play');
            playIcon.classList.add('fa-pause');
            playerContent.classList.add('playing');

            // ★GA4: 再生イベント
            if (typeof gtag === 'function') {
                gtag('event', 'music_play', { 'track_title': playlist[currentTrackIndex].title });
            }
        }

        function pauseMusic() {
            audio.pause();
            isPlaying = false;
            playIcon.classList.remove('fa-pause');
            playIcon.classList.add('fa-play');
            playerContent.classList.remove('playing');
        }

        function togglePlay() { if (isPlaying) pauseMusic(); else playMusic(); }
        function nextTrack() { currentTrackIndex = (currentTrackIndex + 1) % playlist.length; loadTrack(currentTrackIndex); if (isPlaying) playMusic(); }
        function prevTrack() { currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length; loadTrack(currentTrackIndex); if (isPlaying) playMusic(); }
        function togglePlaylist() { playlistPopup.classList.toggle('show'); }

        createPlaylistHTML();
        loadTrack(currentTrackIndex);
        audio.volume = 0.3;

        playBtn.addEventListener('click', togglePlay);
        nextBtn.addEventListener('click', nextTrack);
        prevBtn.addEventListener('click', prevTrack);
        audio.addEventListener('ended', nextTrack);
        listBtn.addEventListener('click', togglePlaylist);
        artWrapper.addEventListener('click', togglePlaylist);
        textInfoArea.addEventListener('click', togglePlaylist);
        closePlaylistBtn.addEventListener('click', togglePlaylist);
    </script>

    <!-- チャット機能のJavaScript -->
    <script>
        // チャット関連の要素取得
        const chatToggleBtn = document.getElementById('chatToggleBtn');
        const chatWindow = document.getElementById('chatWindow');
        const chatCloseBtn = document.getElementById('chatCloseBtn');
        const chatInput = document.getElementById('chatInput');
        const chatSendBtn = document.getElementById('chatSendBtn');
        const chatBody = document.getElementById('chatBody');
        const chatLimitInfo = document.getElementById('chatLimitInfo');
        const chatContactBtn = document.getElementById('chatContactBtn');
        const contactModal = document.getElementById('contactModal');
        const openModalBtn = document.getElementById('openModalBtn');

        // LocalStorageキー
        const CHAT_LIMIT_KEY = 'chat_send_count';
        const CHAT_DATE_KEY = 'chat_last_date';
        const MAX_SENDS_PER_DAY = 5;

        // 日付を取得（YYYY-MM-DD形式）
        function getTodayString() {
            const today = new Date();
            return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        }

        // 今日の送信回数を取得
        function getTodaySendCount() {
            const lastDate = localStorage.getItem(CHAT_DATE_KEY);
            const today = getTodayString();
            
            if (lastDate !== today) {
                // 日付が変わったらリセット
                localStorage.setItem(CHAT_DATE_KEY, today);
                localStorage.setItem(CHAT_LIMIT_KEY, '0');
                return 0;
            }
            
            return parseInt(localStorage.getItem(CHAT_LIMIT_KEY) || '0', 10);
        }

        // 送信回数を増やす
        function incrementSendCount() {
            const count = getTodaySendCount() + 1;
            localStorage.setItem(CHAT_LIMIT_KEY, String(count));
            return count;
        }

        // 送信制限情報を表示
        function updateLimitInfo() {
            const count = getTodaySendCount();
            const remaining = MAX_SENDS_PER_DAY - count;
            
            if (remaining <= 0) {
                chatLimitInfo.textContent = '本日の送信回数上限に達しました。明日またお試しください。';
                chatLimitInfo.style.color = '#ff4d4d';
                chatSendBtn.disabled = true;
                chatInput.disabled = true;
            } else {
                chatLimitInfo.textContent = `本日の残り送信回数: ${remaining}回`;
                chatLimitInfo.style.color = '#aaa';
                chatSendBtn.disabled = false;
                chatInput.disabled = false;
            }
        }

        // 吹き出しのメッセージ切り替え
        const chatBubble = document.getElementById('chatBubble');
        const chatBubbleText = document.getElementById('chatBubbleText');
        const messages = ['チャットBOTだよ', '相談してね'];
        let messageIndex = 0;
        let bubbleInterval = null;
        let isBubbleVisible = true;
        let phase = 'show'; // 'show' or 'hide'

        function showBubble() {
            if (chatBubble && chatBubbleText && !chatToggleBtn.classList.contains('chat-open')) {
                chatBubble.style.visibility = 'visible';
                chatBubble.style.opacity = '1';
                chatBubbleText.textContent = messages[messageIndex];
                isBubbleVisible = true;
                phase = 'show';
            }
        }

        function hideBubble() {
            if (chatBubble && !chatToggleBtn.classList.contains('chat-open')) {
                chatBubble.style.visibility = 'hidden';
                chatBubble.style.opacity = '0';
                isBubbleVisible = false;
                phase = 'hide';
            }
        }

        function updateBubbleMessage() {
            if (chatToggleBtn.classList.contains('chat-open')) return;
            
            if (phase === 'show') {
                // メッセージを5秒表示した後、非表示に
                hideBubble();
            } else {
                // 5秒非表示の後、次のメッセージを表示
                messageIndex = (messageIndex + 1) % messages.length;
                showBubble();
            }
        }

        function startBubbleAnimation() {
            if (bubbleInterval) clearInterval(bubbleInterval);
            // 最初のメッセージを表示
            messageIndex = 0;
            showBubble();
            // 5秒ごとに切り替え（表示5秒→非表示5秒→次のメッセージ5秒→非表示5秒...）
            bubbleInterval = setInterval(updateBubbleMessage, 5000);
        }

        function stopBubbleAnimation() {
            if (bubbleInterval) {
                clearInterval(bubbleInterval);
                bubbleInterval = null;
            }
        }

        // 初期化時にアニメーション開始
        startBubbleAnimation();

        // チャット窓を開く
        function openChat() {
            chatWindow.classList.add('chat-open');
            chatToggleBtn.classList.add('chat-open');
            chatToggleBtn.style.display = 'none';
            if (chatBubble) {
                chatBubble.style.display = 'none';
                chatBubble.style.visibility = 'hidden';
                chatBubble.style.opacity = '0';
            }
            stopBubbleAnimation();
            updateLimitInfo();
        }

        // チャット窓を閉じる
        function closeChat() {
            chatWindow.classList.remove('chat-open');
            chatToggleBtn.classList.remove('chat-open');
            chatToggleBtn.style.display = 'flex';
            if (chatBubble) {
                chatBubble.style.display = 'block';
                // 表示状態に応じてvisibilityとopacityを設定
                if (isBubbleVisible) {
                    chatBubble.style.visibility = 'visible';
                    chatBubble.style.opacity = '1';
                } else {
                    chatBubble.style.visibility = 'hidden';
                    chatBubble.style.opacity = '0';
                }
            }
            startBubbleAnimation();
            // チャットを閉じた時に通常アイコンに戻す
            const chatbotIcon = chatToggleBtn.querySelector('.chatbot-icon');
            if (chatbotIcon) {
                chatbotIcon.src = 'images/chatboticon.webp';
            }
        }

        // ボットメッセージを表示するヘルパー関数
        function showBotMessage(text) {
            const botMessageDiv = document.createElement('div');
            botMessageDiv.className = 'chat-message bot-message';
            botMessageDiv.innerHTML = `
                <img src="images/chatboticon.webp" alt="チャットボット" class="bot-avatar">
                <div class="bot-message-content">
                    <p>${text}</p>
                </div>
            `;
            chatBody.appendChild(botMessageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // ボタンクリック時の返答メッセージ
        const buttonResponses = {
            'web': 'Web制作でビジネスを加速させましょう！どのようなWebサイトやサービスをお考えですか？',
            'ai': 'AIで業務をスマートにしましょう！具体的にどんな作業を自動化したいですか？',
            'media': '楽曲・動画制作でコンテンツの魅力を最大化しましょう！どのような用途でお使いになりますか？',
            'other': 'その他のご相談もお気軽にどうぞ！どのようなお手伝いができますか？'
        };

        // クイックボタンのクリック処理
        function handleQuickButtonClick(buttonText, action) {
            // ユーザーメッセージを表示
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'chat-message user-message';
            userMessageDiv.innerHTML = `<p>${buttonText}</p>`;
            chatBody.appendChild(userMessageDiv);

            // クイックボタンを非表示にする
            const quickButtons = document.getElementById('chatQuickButtons');
            if (quickButtons) {
                quickButtons.style.display = 'none';
            }

            // ボットの返答を表示
            setTimeout(() => {
                showBotMessage(buttonResponses[action] || 'ご相談ありがとうございます。詳細を教えていただけますか？');
            }, 500);

            // スクロール
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // メッセージを送信
        function sendMessage() {
            const message = chatInput.value.trim();
            
            // 5文字未満チェック
            if (message.length < 5) {
                // ユーザーメッセージを表示（送信回数は消費しない）
                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'chat-message user-message';
                userMessageDiv.innerHTML = `<p>${message}</p>`;
                chatBody.appendChild(userMessageDiv);
                
                // 入力欄をクリア
                chatInput.value = '';
                
                // AIエージェントからの警告メッセージを表示（送信回数は消費しない）
                setTimeout(() => {
                    showBotMessage('もう少し具体的（5文字以上）に教えていただけますか？');
                }, 300);
                
                // スクロール
                chatBody.scrollTop = chatBody.scrollHeight;
                return;
            }

            // 送信回数チェック
            const count = getTodaySendCount();
            if (count >= MAX_SENDS_PER_DAY) {
                alert('本日の送信回数上限に達しました。明日またお試しください。');
                return;
            }

            // ユーザーメッセージを表示
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'chat-message user-message';
            userMessageDiv.innerHTML = `<p>${message}</p>`;
            chatBody.appendChild(userMessageDiv);

            // 送信回数を増やす
            incrementSendCount();
            updateLimitInfo();

            // 入力欄をクリア
            chatInput.value = '';

            // ボットの返信（簡易版）
            setTimeout(() => {
                showBotMessage('メッセージありがとうございます。内容を確認し、後日ご返信いたします。');
            }, 500);

            // スクロール
            chatBody.scrollTop = chatBody.scrollHeight;

            // GA4イベント送信
            if (typeof gtag === 'function') {
                gtag('event', 'chat_send', {
                    'event_category': 'engagement',
                    'event_label': 'Chat Message Sent'
                });
            }
        }

        // チャットボタンの画像要素を取得
        const chatbotIcon = chatToggleBtn.querySelector('.chatbot-icon');
        const NORMAL_ICON = 'images/chatboticon.webp';
        const HAPPY_ICON = 'images/chatboticon_happy.webp';

        // ホバー/タップ時に画像を切り替え
        function showHappyIcon() {
            if (chatbotIcon && !chatToggleBtn.classList.contains('chat-open')) {
                chatbotIcon.src = HAPPY_ICON;
                // Happyアイコン時に「おおお！！」を表示
                if (chatBubble && chatBubbleText) {
                    chatBubble.style.display = 'block';
                    chatBubble.style.visibility = 'visible';
                    chatBubble.style.opacity = '1';
                    chatBubbleText.textContent = 'おおお！！';
                }
            }
        }

        function showNormalIcon() {
            if (chatbotIcon && !chatToggleBtn.classList.contains('chat-open')) {
                chatbotIcon.src = NORMAL_ICON;
                // 通常アイコンに戻したら、通常のメッセージ表示に戻す
                if (chatBubble && chatBubbleText) {
                    if (phase === 'show' && isBubbleVisible) {
                        // 表示中なら、現在のメッセージを表示
                        chatBubbleText.textContent = messages[messageIndex];
                    } else if (phase === 'hide' || !isBubbleVisible) {
                        // 非表示中なら非表示のまま
                        chatBubble.style.display = 'none';
                    }
                }
            }
        }

        // マウスイベント
        chatToggleBtn.addEventListener('mouseenter', showHappyIcon);
        chatToggleBtn.addEventListener('mouseleave', showNormalIcon);

        // タッチイベント（モバイル対応）
        chatToggleBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            showHappyIcon();
        });
        chatToggleBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            showNormalIcon();
            // モバイルではclickイベントが発火しないため、直接openChatを呼ぶ
            openChat();
        });

        // クイックボタンのイベントリスナー
        document.querySelectorAll('.quick-btn').forEach(button => {
            button.addEventListener('click', () => {
                const buttonText = button.textContent;
                const action = button.getAttribute('data-action');
                handleQuickButtonClick(buttonText, action);
            });
        });

        // イベントリスナー
        chatToggleBtn.addEventListener('click', openChat);
        chatCloseBtn.addEventListener('click', closeChat);
        chatSendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        chatContactBtn.addEventListener('click', () => {
            contactModal.style.display = 'flex';
            closeChat();
        });

        // 初期化
        updateLimitInfo();
    </script>
<script src="script.js"></script>
</body>
</html>